{"version":3,"file":"utils.js","sources":["uni_modules/uni-forms/components/uni-forms/utils.js"],"sourcesContent":["/**\r\n * 简单处理对象拷贝\r\n * @param {Obejct} 被拷贝对象\r\n * @@return {Object} 拷贝对象\r\n */\r\nexport const deepCopy = (val) => {\r\n\treturn JSON.parse(JSON.stringify(val))\r\n}\r\n/**\r\n * 过滤数字类型\r\n * @param {String} format 数字类型\r\n * @@return {Boolean} 返回是否为数字类型\r\n */\r\nexport const typeFilter = (format) => {\r\n\treturn format === 'int' || format === 'double' || format === 'number' || format === 'timestamp';\r\n}\r\n\r\n/**\r\n * 把 value 转换成指定的类型，用于处理初始值，原因是初始值需要入库不能为 undefined\r\n * @param {String} key 字段名\r\n * @param {any} value 字段值\r\n * @param {Object} rules 表单校验规则\r\n */\r\nexport const getValue = (key, value, rules) => {\r\n\tconst isRuleNumType = rules.find(val => val.format && typeFilter(val.format));\r\n\tconst isRuleBoolType = rules.find(val => (val.format && val.format === 'boolean') || val.format === 'bool');\r\n\t// 输入类型为 number\r\n\tif (!!isRuleNumType) {\r\n\t\tif (!value && value !== 0) {\r\n\t\t\tvalue = null\r\n\t\t} else {\r\n\t\t\tvalue = isNumber(Number(value)) ? Number(value) : value\r\n\t\t}\r\n\t}\r\n\r\n\t// 输入类型为 boolean\r\n\tif (!!isRuleBoolType) {\r\n\t\tvalue = isBoolean(value) ? value : false\r\n\t}\r\n\r\n\treturn value;\r\n}\r\n\r\n/**\r\n * 获取表单数据\r\n * @param {String|Array} name 真实名称，需要使用 realName 获取\r\n * @param {Object} data 原始数据\r\n * @param {any} value  需要设置的值\r\n */\r\nexport const setDataValue = (field, formdata, value) => {\r\n\tformdata[field] = value\r\n\treturn value || ''\r\n}\r\n\r\n/**\r\n * 获取表单数据\r\n * @param {String|Array} field 真实名称，需要使用 realName 获取\r\n * @param {Object} data 原始数据\r\n */\r\nexport const getDataValue = (field, data) => {\r\n\treturn objGet(data, field)\r\n}\r\n\r\n/**\r\n * 获取表单类型\r\n * @param {String|Array} field 真实名称，需要使用 realName 获取\r\n */\r\nexport const getDataValueType = (field, data) => {\r\n\tconst value = getDataValue(field, data)\r\n\treturn {\r\n\t\ttype: type(value),\r\n\t\tvalue\r\n\t}\r\n}\r\n\r\n/**\r\n * 获取表单可用的真实name\r\n * @param {String|Array} name 表单name\r\n * @@return {String} 表单可用的真实name\r\n */\r\nexport const realName = (name, data = {}) => {\n\tconst base_name = _basePath(name)\n\tif (typeof base_name === 'object' && Array.isArray(base_name) && base_name.length > 1) {\r\n\t\tconst realname = base_name.reduce((a, b) => a += `#${b}`, '_formdata_')\r\n\t\treturn realname\r\n\t}\r\n\treturn base_name[0] || name\r\n}\r\n\r\n/**\r\n * 判断是否表单可用的真实name\r\n * @param {String|Array} name 表单name\r\n * @@return {String} 表单可用的真实name\r\n */\r\nexport const isRealName = (name) => {\r\n\tconst reg = /^_formdata_#*/\r\n\treturn reg.test(name)\r\n}\r\n\r\n/**\r\n * 获取表单数据的原始格式\r\n * @@return {Object|Array} object 需要解析的数据\r\n */\r\nexport const rawData = (object = {}, name) => {\r\n\tlet newData = JSON.parse(JSON.stringify(object))\n\tlet formData = {}\r\n\tfor(let i in newData){\n\t\tlet path = name2arr(i)\n\t\tobjSet(formData,path,newData[i])\n\t}\n\treturn formData\n}\r\n\r\n/**\r\n * 真实name还原为 array\r\n * @param {*} name \r\n */\r\nexport const name2arr = (name) => {\r\n\tlet field = name.replace('_formdata_#', '')\r\n\tfield = field.split('#').map(v => (isNumber(v) ? Number(v) : v))\r\n\treturn field\r\n}\r\n\r\n/**\r\n * 对象中设置值\r\n * @param {Object|Array} object 源数据\r\n * @param {String| Array} path 'a.b.c' 或 ['a',0,'b','c']\r\n * @param {String} value 需要设置的值\r\n */\r\nexport const objSet = (object, path, value) => {\r\n\tif (typeof object !== 'object') return object;\r\n\t_basePath(path).reduce((o, k, i, _) => {\r\n\t\tif (i === _.length - 1) { \n\t\t\t// 若遍历结束直接赋值\r\n\t\t\to[k] = value\r\n\t\t\treturn null\r\n\t\t} else if (k in o) { \n\t\t\t// 若存在对应路径，则返回找到的对象，进行下一次遍历\r\n\t\t\treturn o[k]\r\n\t\t} else { \n\t\t\t// 若不存在对应路径，则创建对应对象，若下一路径是数字，新对象赋值为空数组，否则赋值为空对象\r\n\t\t\to[k] = /^[0-9]{1,}$/.test(_[i + 1]) ? [] : {}\r\n\t\t\treturn o[k]\r\n\t\t}\r\n\t}, object)\r\n\t// 返回object\r\n\treturn object;\r\n}\r\n\r\n// 处理 path， path有三种形式：'a[0].b.c'、'a.0.b.c' 和 ['a','0','b','c']，需要统一处理成数组，便于后续使用\r\nfunction _basePath(path) {\r\n\t// 若是数组，则直接返回\r\n\tif (Array.isArray(path)) return path\r\n\t// 若有 '[',']'，则替换成将 '[' 替换成 '.',去掉 ']'\r\n\treturn path.replace(/\\[/g, '.').replace(/\\]/g, '').split('.')\r\n}\r\n\r\n/**\r\n * 从对象中获取值\r\n * @param {Object|Array} object 源数据\r\n * @param {String| Array} path 'a.b.c' 或 ['a',0,'b','c']\r\n * @param {String} defaultVal 如果无法从调用链中获取值的默认值\r\n */\r\nexport const objGet = (object, path, defaultVal = 'undefined') => {\r\n\t// 先将path处理成统一格式\r\n\tlet newPath = _basePath(path)\r\n\t// 递归处理，返回最后结果\r\n\tlet val = newPath.reduce((o, k) => {\r\n\t\treturn (o || {})[k]\r\n\t}, object);\r\n\treturn !val || val !== undefined ? val : defaultVal\r\n}\r\n\r\n\r\n/**\r\n * 是否为 number 类型 \r\n * @param {any} num 需要判断的值\r\n * @return {Boolean} 是否为 number\r\n */\r\nexport const isNumber = (num) => {\r\n\treturn !isNaN(Number(num))\r\n}\r\n\r\n/**\r\n * 是否为 boolean 类型 \r\n * @param {any} bool 需要判断的值\r\n * @return {Boolean} 是否为 boolean\r\n */\r\nexport const isBoolean = (bool) => {\r\n\treturn (typeof bool === 'boolean')\r\n}\r\n/**\r\n * 是否有必填字段\r\n * @param {Object} rules 规则\r\n * @return {Boolean} 是否有必填字段\r\n */\r\nexport const isRequiredField = (rules) => {\r\n\tlet isNoField = false;\r\n\tfor (let i = 0; i < rules.length; i++) {\r\n\t\tconst ruleData = rules[i];\r\n\t\tif (ruleData.required) {\r\n\t\t\tisNoField = true;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn isNoField;\r\n}\r\n\r\n\r\n/**\r\n * 获取数据类型\r\n * @param {Any} obj 需要获取数据类型的值\r\n */\r\nexport const type = (obj) => {\r\n\tvar class2type = {};\r\n\r\n\t// 生成class2type映射\r\n\t\"Boolean Number String Function Array Date RegExp Object Error\".split(\" \").map(function(item, index) {\r\n\t\tclass2type[\"[object \" + item + \"]\"] = item.toLowerCase();\r\n\t})\r\n\tif (obj == null) {\r\n\t\treturn obj + \"\";\r\n\t}\r\n\treturn typeof obj === \"object\" || typeof obj === \"function\" ?\r\n\t\tclass2type[Object.prototype.toString.call(obj)] || \"object\" :\r\n\t\ttypeof obj;\r\n}\r\n\r\n/**\r\n * 判断两个值是否相等\r\n * @param {any} a 值  \r\n * @param {any} b 值  \r\n * @return {Boolean} 是否相等\r\n */\r\nexport const isEqual = (a, b) => {\r\n\t//如果a和b本来就全等\r\n\tif (a === b) {\r\n\t\t//判断是否为0和-0\r\n\t\treturn a !== 0 || 1 / a === 1 / b;\r\n\t}\r\n\t//判断是否为null和undefined\r\n\tif (a == null || b == null) {\r\n\t\treturn a === b;\r\n\t}\r\n\t//接下来判断a和b的数据类型\r\n\tvar classNameA = toString.call(a),\r\n\t\tclassNameB = toString.call(b);\r\n\t//如果数据类型不相等，则返回false\r\n\tif (classNameA !== classNameB) {\r\n\t\treturn false;\r\n\t}\r\n\t//如果数据类型相等，再根据不同数据类型分别判断\r\n\tswitch (classNameA) {\r\n\t\tcase '[object RegExp]':\r\n\t\tcase '[object String]':\r\n\t\t\t//进行字符串转换比较\r\n\t\t\treturn '' + a === '' + b;\r\n\t\tcase '[object Number]':\r\n\t\t\t//进行数字转换比较,判断是否为NaN\r\n\t\t\tif (+a !== +a) {\r\n\t\t\t\treturn +b !== +b;\r\n\t\t\t}\r\n\t\t\t//判断是否为0或-0\r\n\t\t\treturn +a === 0 ? 1 / +a === 1 / b : +a === +b;\r\n\t\tcase '[object Date]':\r\n\t\tcase '[object Boolean]':\r\n\t\t\treturn +a === +b;\r\n\t}\r\n\t//如果是对象类型\r\n\tif (classNameA == '[object Object]') {\r\n\t\t//获取a和b的属性长度\r\n\t\tvar propsA = Object.getOwnPropertyNames(a),\r\n\t\t\tpropsB = Object.getOwnPropertyNames(b);\r\n\t\tif (propsA.length != propsB.length) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tfor (var i = 0; i < propsA.length; i++) {\r\n\t\t\tvar propName = propsA[i];\r\n\t\t\t//如果对应属性对应值不相等，则返回false\r\n\t\t\tif (a[propName] !== b[propName]) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\t//如果是数组类型\r\n\tif (classNameA == '[object Array]') {\r\n\t\tif (a.toString() == b.toString()) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\n"],"names":[],"mappings":"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"}